top_20_genes
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(y = Frequency)) +
geom_bar(stat = "identity")
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(y = Frequency))
# Create a relative frequency vector
gene_frequency_vector <- data.frame(
Hugo_Symbol = rownames(gene_patient_matrix),
Frequency = (rowSums(gene_patient_matrix))/(ncol(gene_patient_matrix))
)
#rownames(gene_frequency_vector) <- #rownames(gene_patient_matrix)
# Sort genes by mutation frequency (descending)
gene_frequency_vector <- gene_frequency_vector[order(-gene_frequency_vector$Frequency), , drop = FALSE]
# Extract top 20 genes
top_20_genes <- head(gene_frequency_vector, 20)
# Display top 20 genes
top_20_genes
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = Hugo_Symbol, y = Frequency))
# Create a relative frequency vector
gene_frequency_vector <- data.frame(
Frequency = (rowSums(gene_patient_matrix))/(ncol(gene_patient_matrix))
)
rownames(gene_frequency_vector) <- rownames(gene_patient_matrix)
# Sort genes by mutation frequency (descending)
gene_frequency_vector <- gene_frequency_vector[order(-gene_frequency_vector$Frequency), , drop = FALSE]
# Extract top 20 genes
top_20_genes <- head(gene_frequency_vector, 20)
# Display top 20 genes
top_20_genes
# Create a relative frequency vector
gene_frequency_vector <- data.frame(
Hugo_Symbol = rownames(gene_patient_matrix),
Frequency = (rowSums(gene_patient_matrix))/(ncol(gene_patient_matrix))
)
#rownames(gene_frequency_vector) <- #rownames(gene_patient_matrix)
# Sort genes by mutation frequency (descending)
gene_frequency_vector <- gene_frequency_vector[order(-gene_frequency_vector$Frequency), , drop = FALSE]
# Extract top 20 genes
top_20_genes <- head(gene_frequency_vector, 20)
# Display top 20 genes
top_20_genes
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
coord_flip() +  # horizontal bars
labs(title = "Top 20 Mutated Genes",
x = "Gene",
y = "Mutation Frequency") +
theme_minimal()
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal()
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = Hugo_Symbol, y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Mutated Genes in KIRC",
x = "Gene Hugo Symbol",
y = "Relative Mutation Frequency") +
theme_minimal()
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Mutated Genes in KIRC",
x = "Gene Hugo Symbol",
y = "Relative Mutation Frequency") +
theme_minimal()
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Mutated Genes in KIRC",
x = "Gene Hugo Symbol",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Dangerously Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Non-synonymously Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Non-Synonymously Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
View(gene_patient_matrix)
# Load the library
library(dbscan)
# Download DBSCAN library
install.packages("dbscan")
# Load the library
library(dbscan)
# Prepare matrix for clustering
gene_patient_matrix <- t(gene_patient_matrix)
# Optional: Perform dimensionality reduction for visualization
# Methods: PCA, t-SNE, UMAP
# [INSERT CODE HERE]
View(gene_patient_matrix)
# Determine the minimum size of a cluster
min_size <- c(5, 10, 20, 30, 40, 50)
hdbscan_results <- hdbscan(gene_patient_matrix, minPts = 5)
hdbscan_results
plot(hdbscan_results)
# Download DBSCAN library
# install.packages("dbscan")
# Load the library
library(dbscan)
# Prepare matrix for clustering - Only the top 20 mutated genes
gene_patient_matrix_reduced <- gene_patient_matrix[gene_patient_matrix %in% top_20_genes$Hugo_Symbol, ]
RNAseq_KIRC <- read.csv("RNAseq_KIRC.csv")
data_clinical_patient <- read.delim("data_clinical_patient.txt", header = TRUE, sep = "\t", skip = 4)
data_mutations <- read.delim("data_mutations.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE)
head(data_clinical_patient)
# RNAseq_KIRC dataset
rna_patient_ids <- gsub("\\.", "-", substr(colnames(RNAseq_KIRC), 1, 12))
# Data_clinical_patient dataset
clinical_patient_ids <- unique(data_clinical_patient$PATIENT_ID)
# Data_mutation dataset
mutation_patient_ids <- unique(substr(data_mutations$Tumor_Sample_Barcode, 1, 12))
# Common patients
common_patients <- Reduce(intersect, list(rna_patient_ids, clinical_patient_ids, mutation_patient_ids))
# Tumour Stage: AJCC_PATHOLOGIC_TUMOR_STAGE
# OS: Overall Survival - Time from the start of the study/treatment to death from any cause.
# DSS: Disease-Specific Survival - Time from the start of the study/treatment to death specifically due to the cancer.
# DFS: Disease-Free Survival - Time from the date of cure until the first sign of disease recurrence or death from any cause.
# PFS: Progression-Free Survival - Time from the start of treatment until the first sign of disease growth/spread (progression) or death from any cause.
#colnames(data_clinical_patient)
# Step 1: Inspect unique values to see exact formatting
unique(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)
# Step 2: Clean the column (remove spaces, lowercase, handle NAs)
stages <- trimws(tolower(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE))
# Convert Roman numerals to numbers
data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE <- sapply(stages, function(x) {
if (grepl("stage", x)) {
as.numeric(as.roman(gsub("stage ", "", x)))
} else {
NA
}
})
library(dplyr)
library(stringr)
# Convert OS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
mutate(
#convert to uppercase and remove spaces
OS_clean = toupper(str_replace_all(OS_STATUS, " ", "")),
OS_STATUS = str_replace_all(OS_clean, c(
"0:LIVING" = "1",
"1:DECEASED" = "0")
),
# Convert the resulting column to numeric
OS_STATUS = as.numeric(OS_STATUS)
)
# Convert DSS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
mutate(
#convert to uppercase and remove spaces
DSS_clean = toupper(str_replace_all(DSS_STATUS, " ", "")),
DSS_STATUS = str_replace_all(DSS_clean, c(
"0:ALIVEORDEADTUMORFREE" = "1",
"1:DEADWITHTUMOR" = "0")
),
# Convert the resulting column to numeric
DSS_STATUS = as.numeric(DSS_STATUS)
)
# Convert DFS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
mutate(
#convert to uppercase and remove spaces
DFS_clean = toupper(str_replace_all(DFS_STATUS, " ", "")),
DFS_STATUS = str_replace_all(DFS_clean, c(
"0:DISEASEFREE" = "1",
"1:RECURRED/PROGRESSED" = "0")
),
# Convert the resulting column to numeric
DFS_STATUS = as.numeric(DFS_STATUS)
)
# Convert PFS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
mutate(
#convert to uppercase and remove spaces
PFS_clean = toupper(str_replace_all(PFS_STATUS, " ", "")),
PFS_STATUS = str_replace_all(PFS_clean, c(
"0:CENSORED" = "1",
"1:PROGRESSION" = "0")
),
# Convert the resulting column to numeric
PFS_STATUS = as.numeric(PFS_STATUS)
)
head(data_clinical_patient, 100)
# Age associated with patients
# Check this - I got rid of matching step
#common_patient_ages <- data_clinical_patient$AGE[match(common_patients, data_clinical_patient$PATIENT_ID)]
# Load the ggplot2 library
library(ggplot2)
# Convert to a dataframe
age_df <- data.frame(AGE = data_clinical_patient$AGE)
# Plot the boxplot
ggplot(age_df, aes(x = AGE)) +
geom_boxplot(fill = "skyblue", color = "black") +
labs(
title = "Distribution of Ages Among Patients",
x = "Age (years)",
y = ""
) +
theme_minimal(base_size = 14)
# Tumor stage associated with patients
# Convert to a dataframe
stage_df <- data.frame(STAGE = data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)
# Plot the bar graph
ggplot(stage_df, aes(x = STAGE)) +
geom_bar(fill = "skyblue", color = "black") +
labs(
title = "Number of Patients by Tumor Stage",
x = "Tumor Stage",
y = "Count"
) +
theme_minimal(base_size = 14)
# Find the different Categories
#head(data_clinical_patient, 30)
#unique(data_clinical_patient$GENETIC_ANCESTRY_LABEL)
library(ggplot2)
plot_donut <- function(data, column_name, title) {
# Convert to character
col <- as.character(data[[column_name]])
# Replace blank or whitespace-only values with "Unknown" to label its column
col[trimws(col) == ""] <- "Unknown"
# If this is the ancestry column, apply the cleaner label mapping
if (column_name == "GENETIC_ANCESTRY_LABEL") {
ancestry_labels <- c(
"AFR"        = "African",
"AFR_ADMIX"  = "African (Admixed)",
"AMR"        = "Americas / Latino",
"EAS"        = "East Asian",
"EAS_ADMIX"  = "East Asian (Admixed)",
"EUR"        = "European",
"EUR_ADMIX"  = "European (Admixed)",
"SAS_ADMIX"  = "South Asian (Admixed)",
"Unknown"    = "Unknown"
)
# Map values - unmapped values become NA, so protect against that
col <- ifelse(col %in% names(ancestry_labels),
ancestry_labels[col],
col)
}
# Build frequency table
freq <- table(col)
df <- as.data.frame(freq)
colnames(df) <- c("Category", "Count")
df$Fraction <- df$Count / sum(df$Count)
# Build legend labels with percentages
legend_labels <- paste0(df$Category, " (", round(df$Fraction * 100, 1), "%)")
names(legend_labels) <- df$Category
ggplot(df, aes(x = "", y = Fraction, fill = Category)) +
geom_col(width = 1) +
coord_polar("y") +
scale_fill_discrete(labels = legend_labels) +
labs(title = title, fill = column_name) +
theme_void()
}
plot_donut(data_clinical_patient, "SEX", "Sex Distribution")
plot_donut(data_clinical_patient, "ETHNICITY", "Ethnicity Distribution")
plot_donut(data_clinical_patient, "RACE", "Race Distribution")
plot_donut(data_clinical_patient, "GENETIC_ANCESTRY_LABEL", "Ancestry Distribution")
library(survival)
library(survminer)
# Create a survival object
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS,
event = 1 - data_clinical_patient$OS_STATUS)
# Note: OS_STATUS: 1 = alive, 0 = deceased, so event = 1 - OS_STATUS
# Fit Kaplan-Meier model
fit_os <- survfit(surv_os ~ 1)
# Plot
ggsurvplot(fit_os,
data = data_clinical_patient,
risk.table = TRUE,
conf.int = TRUE,
palette = "Dark2",
title = "Kaplan-Meier Curve: Overall Survival (OS)",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
surv_dss <- Surv(time = data_clinical_patient$DSS_MONTHS,
event = 1 - data_clinical_patient$DSS_STATUS)
fit_dss <- survfit(surv_dss ~ 1)
ggsurvplot(fit_dss,
data = data_clinical_patient,
risk.table = TRUE,
conf.int = TRUE,
palette = "Dark2",
title = "Kaplan-Meier Curve: Disease-Specific Survival (DSS)",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
surv_pfs <- Surv(time = data_clinical_patient$PFS_MONTHS,
event = 1 - data_clinical_patient$PFS_STATUS)
fit_pfs <- survfit(surv_pfs ~ 1)
ggsurvplot(fit_pfs,
data = data_clinical_patient,
risk.table = TRUE,
conf.int = TRUE,
palette = "Dark2",
title = "Kaplan-Meier Curve: Progression-Free Survival (PFS)",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
surv_dfs <- Surv(time = data_clinical_patient$DFS_MONTHS,
event = 1 - data_clinical_patient$DFS_STATUS)
fit_dfs <- survfit(surv_dfs ~ 1)
ggsurvplot(fit_dfs,
data = data_clinical_patient,
risk.table = TRUE,
conf.int = TRUE,
palette = "Dark2",
title = "Kaplan-Meier Curve: Disease-Free Survival (DFS)",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
# Create age groups (above vs below median)
median_age <- median(data_clinical_patient$AGE, na.rm = TRUE)
data_clinical_patient$AGE_GROUP <- ifelse(data_clinical_patient$AGE <= median_age,
paste0("<= ", median_age),
paste0("> ", median_age))
# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS,
event = 1 - data_clinical_patient$OS_STATUS)
# Fit Kaplan-Meier by age group
fit_age <- survfit(surv_os ~ AGE_GROUP, data = data_clinical_patient)
# Plot
ggsurvplot(fit_age,
data = data_clinical_patient,
pval = TRUE,   # shows log-rank p-value
conf.int = TRUE,
palette = c("skyblue", "blue"),
title = "Overall Survival by Age Group",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
# Make sure stage is factor
data_clinical_patient$STAGE_FACTOR <- factor(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)
# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS,
event = 1 - data_clinical_patient$OS_STATUS)
# Fit Kaplan-Meier by tumor stage
fit_stage <- survfit(surv_os ~ STAGE_FACTOR, data = data_clinical_patient) # All my values show N/A for AJCC_PATHOLOGIC, therefore nothing will work here.
# Plot
ggsurvplot(fit_stage,
data = data_clinical_patient,
pval = TRUE,
conf.int = TRUE,
palette = "Set1",
title = "Overall Survival by Tumor Stage",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
# Make sure sex is factor
data_clinical_patient$SEX <- factor(ifelse(is.na(data_clinical_patient$SEX) |
data_clinical_patient$SEX == "",
"Unknown",
data_clinical_patient$SEX))
# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS,
event = 1 - data_clinical_patient$OS_STATUS)
# Fit Kaplan-Meier by sex
fit_sex <- survfit(surv_os ~ SEX, data = data_clinical_patient)
# Plot
ggsurvplot(fit_sex,
data = data_clinical_patient,
pval = TRUE,
conf.int = TRUE,
palette = c("skyblue", "salmon", "grey"),
title = "Overall Survival by Sex",
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(base_size = 14))
# Damaging and Potentially Pathogenic Mutations
damaging_classes <- c(
"Nonsense_Mutation", "Frame_Shift_Del", "Frame_Shift_Ins",
"Splice_Site", "Nonstop_Mutation", "Translation_Start_Site",
"In_Frame_Del", "In_Frame_Ins", "Missense_Mutation"
)
# Filter Synonymous/Silent mutations and ensure that only common patients are kept
damaging_mutations <- data_mutations[
data_mutations$Variant_Classification %in% damaging_classes, ]
non_synonymous_dataset <- damaging_mutations[
substr(damaging_mutations$Tumor_Sample_Barcode, 1, 12) %in% common_patients, ]
# Make a gene list
genes <- unique(non_synonymous_dataset$Hugo_Symbol)
# Create gene-patient matrix
gene_patient_matrix <- matrix(
0,
nrow = length(genes),
ncol = length(common_patients),
dimnames = list(genes, common_patients)
)
# Populate the Matrix
for (i in 1:nrow(non_synonymous_dataset)) {
gene_name <- non_synonymous_dataset$Hugo_Symbol[i]
patient_id <- substr(non_synonymous_dataset$Tumor_Sample_Barcode[i], 1, 12)
gene_patient_matrix[gene_name, patient_id] <- 1
}
# Convert to Data frame
gene_patient_matrix <- as.data.frame(gene_patient_matrix)
# Create a relative frequency vector
gene_frequency_vector <- data.frame(
Hugo_Symbol = rownames(gene_patient_matrix),
Frequency = (rowSums(gene_patient_matrix))/(ncol(gene_patient_matrix))
)
# Sort genes by mutation frequency (descending)
gene_frequency_vector <- gene_frequency_vector[order(-gene_frequency_vector$Frequency), , drop = FALSE]
# Extract top 20 genes
top_20_genes <- head(gene_frequency_vector, 20)
# Display top 20 genes
top_20_genes
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
geom_col(fill = "steelblue") +
labs(title = "Top 20 Non-Synonymously Mutated Genes in KIRC",
x = "Gene",
y = "Relative Mutation Frequency") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.text.y = element_text(size = 12)
)
View(gene_patient_matrix)
# Download DBSCAN library
# install.packages("dbscan")
# Load the library
library(dbscan)
# Prepare matrix for clustering - Only the top 20 mutated genes
important_genes <- top_20_genes$Hugo_Symbol
gene_patient_matrix_reduced <- gene_patient_matrix[
rownames(gene_patient_matrix) %in% important_genes,,drop = FALSE]
View(gene_patient_matrix_reduced)
# Download DBSCAN library
# install.packages("dbscan")
# Load the library
library(dbscan)
# Prepare matrix for clustering - Only the top 20 mutated genes
important_genes <- top_20_genes$Hugo_Symbol
gene_patient_matrix_reduced <- gene_patient_matrix[
rownames(gene_patient_matrix) %in% important_genes,,drop = FALSE]
gene_patient_matrix_reduced <- t(gene_patient_matrix_reduced)
# Determine the minimum size of a cluster
min_size <- c(5, 10, 20, 30, 40, 50)
hdbscan_results <- hdbscan(gene_patient_matrix_reduced, minPts = 5)
hdbscan_results
plot(hdbscan_results)
# Determine the minimum size of a cluster
min_size <- c(5, 10, 20, 30, 40, 50)
hdbscan_results <- hdbscan(gene_patient_matrix_reduced, minPts = 3)
hdbscan_results
plot(hdbscan_results)
# Determine the minimum size of a cluster
min_size <- c(5, 10, 20, 30, 40, 50)
hdbscan_results <- hdbscan(gene_patient_matrix_reduced, minPts = 20)
hdbscan_results
plot(hdbscan_results)
# Determine the minimum size of a cluster
min_size <- c(5, 10, 20, 30, 40, 50)
hdbscan_results <- hdbscan(gene_patient_matrix_reduced, minPts = 30)
hdbscan_results
plot(hdbscan_results)

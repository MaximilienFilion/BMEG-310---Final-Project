---
title: "Final Project Part 1"
author:
- "Maximilien Filion - 20598645, "
- "Aneesh Kaura - 66832304, "
- "Monica Mihailescu - 47409289 "
date: "2025-11-17"
output:
  pdf_document: default
  html_document: default
---

# Final Project Part 1
## Clinical data Analysis

# ==============================================================================
# SECTION 1: DATA PREPROCESSING
# ==============================================================================

## 1.1 Download the data
```{r}
RNAseq_KIRC <- read.csv("RNAseq_KIRC.csv")
data_clinical_patient <- read.delim("data_clinical_patient.txt", header = TRUE, sep = "\t", skip = 4)
data_mutations <- read.delim("data_mutations.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE)
head(data_clinical_patient)
```

## 1.2 Run the intersect of all the patient sets - code reused from lab 7 submission
```{r}
# RNAseq_KIRC dataset
rna_patient_ids <- gsub("\\.", "-", substr(colnames(RNAseq_KIRC), 1, 12))

# Data_clinical_patient dataset
clinical_patient_ids <- unique(data_clinical_patient$PATIENT_ID)

# Data_mutation dataset
mutation_patient_ids <- unique(substr(data_mutations$Tumor_Sample_Barcode, 1, 12))

# Common patients
common_patients <- Reduce(intersect, list(rna_patient_ids, clinical_patient_ids, mutation_patient_ids))
```

## 1.3 Data Cleaning
```{r}
# Tumour Stage: AJCC_PATHOLOGIC_TUMOR_STAGE
# OS: Overall Survival - Time from the start of the study/treatment to death from any cause.
# DSS: Disease-Specific Survival - Time from the start of the study/treatment to death specifically due to the cancer.
# DFS: Disease-Free Survival - Time from the date of cure until the first sign of disease recurrence or death from any cause.
# PFS: Progression-Free Survival - Time from the start of treatment until the first sign of disease growth/spread (progression) or death from any cause.

#colnames(data_clinical_patient)
# Step 1: Inspect unique values to see exact formatting
unique(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)

# Step 2: Clean the column (remove spaces, lowercase, handle NAs)
stages <- trimws(tolower(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE))

# Convert Roman numerals to numbers 
data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE <- sapply(stages, function(x) {
  if (grepl("stage", x)) {
    as.numeric(as.roman(gsub("stage ", "", x)))
  } else {
    NA  
  }
})

library(dplyr)
library(stringr)

# Convert OS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
  mutate(
    #convert to uppercase and remove spaces
    OS_clean = toupper(str_replace_all(OS_STATUS, " ", "")),
    OS_STATUS = str_replace_all(OS_clean, c(
       "0:LIVING" = "1", 
       "1:DECEASED" = "0")
       ),
    # Convert the resulting column to numeric
    OS_STATUS = as.numeric(OS_STATUS)
  )

# Convert DSS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
  mutate(
    #convert to uppercase and remove spaces
    DSS_clean = toupper(str_replace_all(DSS_STATUS, " ", "")),
    DSS_STATUS = str_replace_all(DSS_clean, c(
       "0:ALIVEORDEADTUMORFREE" = "1", 
       "1:DEADWITHTUMOR" = "0")
       ),
    # Convert the resulting column to numeric
    DSS_STATUS = as.numeric(DSS_STATUS)
  )

# Convert DFS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
  mutate(
    #convert to uppercase and remove spaces
    DFS_clean = toupper(str_replace_all(DFS_STATUS, " ", "")),
    DFS_STATUS = str_replace_all(DFS_clean, c(
       "0:DISEASEFREE" = "1", 
       "1:RECURRED/PROGRESSED" = "0")
       ),
    # Convert the resulting column to numeric
    DFS_STATUS = as.numeric(DFS_STATUS)
  )

# Convert PFS into binary Value, where 1 is survival and 0 is end-point
data_clinical_patient <- data_clinical_patient %>%
  mutate(
    #convert to uppercase and remove spaces
    PFS_clean = toupper(str_replace_all(PFS_STATUS, " ", "")),
    PFS_STATUS = str_replace_all(PFS_clean, c(
       "0:CENSORED" = "1", 
       "1:PROGRESSION" = "0")
       ),
    # Convert the resulting column to numeric
    PFS_STATUS = as.numeric(PFS_STATUS)
)
head(data_clinical_patient, 100)
```

# ==============================================================================
# SECTION 2: DATA EXPLORATION
# ==============================================================================

## 2.1 Age of KIRC Patients
```{r}
# Age associated with patients
# Check this - I got rid of matching step 
#common_patient_ages <- data_clinical_patient$AGE[match(common_patients, data_clinical_patient$PATIENT_ID)]

# Load the ggplot2 library
library(ggplot2)

# Convert to a dataframe
age_df <- data.frame(AGE = data_clinical_patient$AGE)

# Plot the boxplot
ggplot(age_df, aes(x = AGE)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(
    title = "Distribution of Ages Among Patients",
    x = "Age (years)",
    y = ""
    ) +
  theme_minimal(base_size = 14)
```

What did we notice?

## 2.2 Tumor Stage of KIRC Patients
```{r}
# Tumor stage associated with patients
# Convert to a dataframe
stage_df <- data.frame(STAGE = data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)

# Plot the bar graph
ggplot(stage_df, aes(x = STAGE)) +
  geom_bar(fill = "skyblue", color = "black") +
  labs(
    title = "Number of Patients by Tumor Stage",
    x = "Tumor Stage",
    y = "Count"
  ) +
  theme_minimal(base_size = 14)
```

What did we notice?

## 2.3 Sex, Ethnicity, Race, and Ancestry of KIRC Patients
```{r}
# Find the different Categories
#head(data_clinical_patient, 30)
#unique(data_clinical_patient$GENETIC_ANCESTRY_LABEL)

library(ggplot2)

plot_donut <- function(data, column_name, title) {
  # Convert to character
  col <- as.character(data[[column_name]])
  # Replace blank or whitespace-only values with "Unknown" to label its column 
  col[trimws(col) == ""] <- "Unknown"
  
  # If this is the ancestry column, apply the cleaner label mapping
  if (column_name == "GENETIC_ANCESTRY_LABEL") {
    ancestry_labels <- c(
      "AFR"        = "African",
      "AFR_ADMIX"  = "African (Admixed)",
      "AMR"        = "Americas / Latino",
      "EAS"        = "East Asian",
      "EAS_ADMIX"  = "East Asian (Admixed)",
      "EUR"        = "European",
      "EUR_ADMIX"  = "European (Admixed)",
      "SAS_ADMIX"  = "South Asian (Admixed)",
      "Unknown"    = "Unknown"
    )
    # Map values - unmapped values become NA, so protect against that
    col <- ifelse(col %in% names(ancestry_labels),
                  ancestry_labels[col],
                  col)
  }

  # Build frequency table
  freq <- table(col)
  df <- as.data.frame(freq)
  colnames(df) <- c("Category", "Count")
  df$Fraction <- df$Count / sum(df$Count)
  
  # Build legend labels with percentages
  legend_labels <- paste0(df$Category, " (", round(df$Fraction * 100, 1), "%)")
  names(legend_labels) <- df$Category
  
  ggplot(df, aes(x = "", y = Fraction, fill = Category)) +
    geom_col(width = 1) +
    coord_polar("y") +
    scale_fill_discrete(labels = legend_labels) +
    labs(title = title, fill = column_name) +
    theme_void()
}

plot_donut(data_clinical_patient, "SEX", "Sex Distribution")
plot_donut(data_clinical_patient, "ETHNICITY", "Ethnicity Distribution")
plot_donut(data_clinical_patient, "RACE", "Race Distribution")
plot_donut(data_clinical_patient, "GENETIC_ANCESTRY_LABEL", "Ancestry Distribution")
```

What did we notice?

## 2.4 Survival Analysis of Overall Survival (OS)
```{r}

library(survival)
library(survminer)
# Create a survival object
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS, 
                event = 1 - data_clinical_patient$OS_STATUS) 
# Note: OS_STATUS: 1 = alive, 0 = deceased, so event = 1 - OS_STATUS

# Fit Kaplan-Meier model
fit_os <- survfit(surv_os ~ 1)

# Plot
ggsurvplot(fit_os,
           data = data_clinical_patient,
           risk.table = TRUE,
           conf.int = TRUE,
           palette = "Dark2",
           title = "Kaplan-Meier Curve: Overall Survival (OS)",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

What did we notice?

## 2.5 Survival Analysis of Disease-Specific Survival (DSS)
```{r}
surv_dss <- Surv(time = data_clinical_patient$DSS_MONTHS, 
                 event = 1 - data_clinical_patient$DSS_STATUS)

fit_dss <- survfit(surv_dss ~ 1)

ggsurvplot(fit_dss,
           data = data_clinical_patient,
           risk.table = TRUE,
           conf.int = TRUE,
           palette = "Dark2",
           title = "Kaplan-Meier Curve: Disease-Specific Survival (DSS)",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

What did we notice?

## 2.6 Survival Analysis of Progression-Free Survival(PFS)
```{r}
surv_pfs <- Surv(time = data_clinical_patient$PFS_MONTHS, 
                 event = 1 - data_clinical_patient$PFS_STATUS)

fit_pfs <- survfit(surv_pfs ~ 1)

ggsurvplot(fit_pfs,
           data = data_clinical_patient,
           risk.table = TRUE,
           conf.int = TRUE,
           palette = "Dark2",
           title = "Kaplan-Meier Curve: Progression-Free Survival (PFS)",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

What did we notice?

## 2.7 Survival Analysis of Disease-Free Survival (DFS)
```{r}
surv_dfs <- Surv(time = data_clinical_patient$DFS_MONTHS, 
                 event = 1 - data_clinical_patient$DFS_STATUS)

fit_dfs <- survfit(surv_dfs ~ 1)

ggsurvplot(fit_dfs,
           data = data_clinical_patient,
           risk.table = TRUE,
           conf.int = TRUE,
           palette = "Dark2",
           title = "Kaplan-Meier Curve: Disease-Free Survival (DFS)",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

What did we notice?

## 2.8 Survival Analysis of Age
```{r}
# Create age groups (above vs below median)
median_age <- median(data_clinical_patient$AGE, na.rm = TRUE)
data_clinical_patient$AGE_GROUP <- ifelse(data_clinical_patient$AGE <= median_age, 
                                          paste0("<= ", median_age), 
                                          paste0("> ", median_age))

# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS, 
                event = 1 - data_clinical_patient$OS_STATUS)

# Fit Kaplan-Meier by age group
fit_age <- survfit(surv_os ~ AGE_GROUP, data = data_clinical_patient)


# Plot
ggsurvplot(fit_age,
           data = data_clinical_patient,
           pval = TRUE,   # shows log-rank p-value
           conf.int = TRUE,
           palette = c("skyblue", "blue"),
           title = "Overall Survival by Age Group",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

What did we notice?

## 2.9 Survival Analysis of Cancer Stage
```{r}
# Make sure stage is factor
data_clinical_patient$STAGE_FACTOR <- factor(data_clinical_patient$AJCC_PATHOLOGIC_TUMOR_STAGE)

# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS, 
                event = 1 - data_clinical_patient$OS_STATUS)

# Fit Kaplan-Meier by tumor stage
fit_stage <- survfit(surv_os ~ STAGE_FACTOR, data = data_clinical_patient) # All my values show N/A for AJCC_PATHOLOGIC, therefore nothing will work here. 

# Plot
ggsurvplot(fit_stage,
           data = data_clinical_patient,
           pval = TRUE,
           conf.int = TRUE,
           palette = "Set1",
           title = "Overall Survival by Tumor Stage",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))

```

What did we notice?

## 2.10 Survival Analysis of Sex
```{r}
# Make sure sex is factor
data_clinical_patient$SEX <- factor(ifelse(is.na(data_clinical_patient$SEX) | 
                                           data_clinical_patient$SEX == "", 
                                           "Unknown", 
                                           data_clinical_patient$SEX))

# Survival object for OS
surv_os <- Surv(time = data_clinical_patient$OS_MONTHS, 
                event = 1 - data_clinical_patient$OS_STATUS)

# Fit Kaplan-Meier by sex
fit_sex <- survfit(surv_os ~ SEX, data = data_clinical_patient)

# Plot
ggsurvplot(fit_sex,
           data = data_clinical_patient,
           pval = TRUE,
           conf.int = TRUE,
           palette = c("skyblue", "salmon", "grey"),
           title = "Overall Survival by Sex",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

## Analyses

# ==============================================================================
# SECTION 3: MUTATION DATA ANALYSIS
# ==============================================================================

# ==============================================================================
# INVESTIGATION 1: Top 20 Most Mutated Genes
# ==============================================================================

## 3.1.1 Build Gene-Patient Mutation Matrix (Data Frame)
# Create binary matrix: rows = genes, columns = patients
We decided to keep only the damaging mutations and exclude the potentially damageable or non-damageable mutations.
```{r inv1_matrix}
# Damaging and Potentially Pathogenic Mutations
damaging_classes <- c(
  "Nonsense_Mutation", "Frame_Shift_Del", "Frame_Shift_Ins",
  "Splice_Site", "Nonstop_Mutation", "Translation_Start_Site",
  "In_Frame_Del", "In_Frame_Ins", "Missense_Mutation"
)

# Filter Synonymous/Silent mutations and ensure that only common patients are kept
damaging_mutations <- data_mutations[
  data_mutations$Variant_Classification %in% damaging_classes, ]

non_synonymous_dataset <- damaging_mutations[
  substr(damaging_mutations$Tumor_Sample_Barcode, 1, 12) %in% common_patients, ]

# Make a gene list
genes <- unique(non_synonymous_dataset$Hugo_Symbol)

# Create gene-patient matrix
gene_patient_matrix <- matrix(
  0, 
  nrow = length(genes), 
  ncol = length(common_patients),
  dimnames = list(genes, common_patients)
)

# Populate the Matrix
for (i in 1:nrow(non_synonymous_dataset)) {
  
  gene_name <- non_synonymous_dataset$Hugo_Symbol[i]
  patient_id <- substr(non_synonymous_dataset$Tumor_Sample_Barcode[i], 1, 12)
  
  gene_patient_matrix[gene_name, patient_id] <- 1
}

# Convert to Data frame
gene_patient_matrix <- as.data.frame(gene_patient_matrix)
```

## 3.1.2 Calculate Mutation Frequencies
# Sum mutations across all patients for each gene
```{r inv1_frequency}
# Create a relative frequency vector
gene_frequency_vector <- data.frame(
  Hugo_Symbol = rownames(gene_patient_matrix),
  Frequency = (rowSums(gene_patient_matrix))/(ncol(gene_patient_matrix))
)

# Sort genes by mutation frequency (descending)
gene_frequency_vector <- gene_frequency_vector[order(-gene_frequency_vector$Frequency), , drop = FALSE]

# Extract top 20 genes
top_20_genes <- head(gene_frequency_vector, 20)

# Display top 20 genes
top_20_genes
```

## 3.1.3 Visualize Top 20 Mutated Genes
# Create bar plot or lollipop chart
```{r inv1_visualize}
# Create visualization of top 20 genes. Create a relative frequency so the data makes more sense
ggplot(top_20_genes, aes(x = reorder(Hugo_Symbol, -Frequency), y = Frequency)) +
  geom_col(fill = "steelblue") +
  labs(title = "Top 20 Non-Synonymously Mutated Genes in KIRC",
       x = "Gene",
       y = "Relative Mutation Frequency") +
  theme_minimal() +
  theme(
  plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
  axis.text.x = element_text(angle = 45, hjust = 1),
  axis.text.y = element_text(size = 12)
  )
```

**Observations:**
# [COMMENT HERE: Which genes are most frequently mutated? Any expected oncogenes?]

# ==============================================================================
# INVESTIGATION 2: Hierarchy-Based Clustering
# ==============================================================================

## 3.2.1 Prepare Data
```{r inv4_prep}
# Prepare matrix for clustering - Only the top 20 mutated genes
important_genes <- top_20_genes$Hugo_Symbol
gene_patient_matrix_reduced <- gene_patient_matrix[
  rownames(gene_patient_matrix) %in% important_genes,,drop = FALSE]
gene_patient_matrix_reduced <- t(gene_patient_matrix_reduced)

```

## 3.2.2 Apply Hierarchical Clustering
# Perform hierarchy-based clustering
```{r inv4_hdbscan}
# Create a distance matrix
dist_matrix <- dist(gene_patient_matrix_reduced, method = "binary")

# Fit the hierarchical clustering using Ward and ward.D2
hc_1 <- hclust(dist_matrix, method = "ward.D")
hc_2 <- hclust(dist_matrix, method = "ward.D2")
```

## 3.2.3 Visualize Dendrogram
```{r inv4_hdbscan}
# Visualize as dendrograms
plot(hc_1, main = "Ward.D Hierarchical Clustering of KIRC Patients",
     xlab = "KIRC Patients", sub = "", cex = 0.8, labels = FALSE)
plot(hc_2, main = "Ward.D2 Hierarchical Clustering of KIRC Patients",
     xlab = "KIRC Patients", sub = "", cex = 0.8, labels = FALSE)
```

**Observations:**
# [COMMENT HERE: How many clusters detected? Are they well-separated?]


## 3.2.3 Assign Cluster to Patients
```{r}
# After Observation it was determined that 4 significant clusters were present in the datastet
k <- 4
clusters_ward_D1 <- cutree(hc_1, k=k)
clusters_ward_D2 <- cutree(hc_2, k=k)
```


# ==============================================================================
# INVESTIGATION 3: Patient Outcomes Across Hierarchical Clusters
# ==============================================================================

## 3.3.1 Assign Patients to hierarchical Clusters
# Link cluster assignments to clinical data
```{r inv5_assign}
# Create a new data frame that has the disease-specific survival, and all the clustering data
clustering_data <- data.frame(
  clusters_ward_D1 = clusters_ward_D1,
  clusters_ward_D2 = clusters_ward_D2,
  PATIENT_ID = names(clusters_ward_D1)
)

rownames(clustering_data) <- NULL

clinical_data_subset <- data_clinical_patient[
 data_clinical_patient$PATIENT_ID %in% clustering_data$PATIENT_ID,
 c("PATIENT_ID", "DSS_STATUS", "DSS_MONTHS")
]

merged_data <- merge(
 clustering_data,
 clinical_data_subset,
 by = "PATIENT_ID",
 all.x = FALSE,  # keep only patients in both datasets
 all.y = FALSE
)

merged_data
```

## 3.3.2 Kaplan-Meier Curves by  Cluster
# Compare survival outcomes across clusters
```{r inv5_survival}
surv_obj_ward <- Surv(time = merged_data$DSS_MONTHS, event=merged_data$DSS_STATUS)

# KM plot for ward_D1 clustering
ward_d1 <- surv_fit(surv_obj_ward ~ clusters_ward_D1, data = merged_data)
ggsurvplot(ward_d1,
           data = merged_data,
           pval = TRUE,
           conf.int = TRUE,
           title = "Disease Specific Survival for Identified Ward.D1 Hierarchical Cluster",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))

# KM plot for ward_D2 clustering
ward_d2 <- surv_fit(surv_obj_ward ~ clusters_ward_D2, data = merged_data)
ggsurvplot(ward_d2,
           data = merged_data,
           pval = TRUE,
           conf.int = TRUE,
           title = "Disease Specific Survival for Identified Ward.D1 Hierarchical Cluster",
           xlab = "Time (Months)",
           ylab = "Survival Probability",
           ggtheme = theme_minimal(base_size = 14))
```

**Observations:**
# [COMMENT HERE: Do  clusters differ in survival?]

## 3.3.3 ANOVA for Continuous Variables
# Test age differences across clusters
```{r inv5_anova}
# One-way ANOVA for age
# [INSERT CODE HERE]

# Post-hoc tests if significant
# [INSERT CODE HERE]

# Visualization
# [INSERT CODE HERE]
```

## 3.3.4 Chi-Square Tests for Categorical Variables
# Test categorical variable differences
```{r inv5_chisq}
# Tumor stage, sex, ethnicity, etc.
# [INSERT CODE HERE]

# Contingency tables and visualizations
# [INSERT CODE HERE]
```


# ==============================================================================
# INVESTIGATION 4: Co-Mutation and Mutual Exclusivity Analysis
# ==============================================================================

## 3.4.1 Create Fisher's Exact Test Function
# Function to test co-occurrence or mutual exclusivity between gene pairs
```{r inv6_function}
# Function: fisher_test_genes(gene1, gene2, gene_patient_matrix)
# Inputs: Two gene names and mutation matrix
# Outputs: Odds ratio, p-value, relationship type
# Function: fisher_test_genes(gene1, gene2, gene_patient_matrix)
fisher_test_genes <- function(gene1, gene2, gene_patient_matrix) {

  g1 <- gene_patient_matrix[, gene1]
  g2 <- gene_patient_matrix[, gene2]

  # Build 2x2 contingency table
  contingency <- table(g1, g2)

  # Skip genes with insufficient combinations
  if (!all(dim(contingency) == c(2, 2))) {
    return(list(odds_ratio = NA, p_value = NA, relationship = "Insufficient data"))
  }

  test <- fisher.test(contingency)

  #odds_ratio <- test$estimate
  odds_ratio <- unname(test$estimate)
  p_val <- test$p.value

  relationship <- ifelse(
    is.na(odds_ratio), 
    "Insufficient data",
    ifelse(odds_ratio > 1, "Co-mutation",
           ifelse(odds_ratio < 1, "Mutual exclusivity", "No association"))
  )

  return(list(odds_ratio = odds_ratio, p_value = p_val, relationship = relationship))
}
```

## 3.4.2 Test All Pairwise Combinations of Top 20 Genes
# Run Fisher's exact test for all gene pairs
```{r inv6_pairwise}
# Get top 20 genes from Investigation 1
top20_gene_names <- top_20_genes$Hugo_Symbol

#matrix has patients as columns and genes as rows. Transpose matrix for fischer
t_gene_patient_matrix <- t(gene_patient_matrix)
t_gene_patient_matrix <- as.data.frame(t_gene_patient_matrix)
colnames(t_gene_patient_matrix)[1:20]
valid_genes <- intersect(top20_gene_names, colnames(t_gene_patient_matrix))
valid_genes

# Generate all pairwise combinations (190 pairs)
pairs <- combn(valid_genes, 2, simplify = FALSE)

# Apply Fisher's exact test to each pair
# Store results in dataframe: gene1, gene2, odds_ratio, p_value
results <- data.frame()
for (pair in pairs) {
  g1 <- pair[1]
  g2 <- pair[2]

  res <- fisher_test_genes(g1, g2, t_gene_patient_matrix)

  results <- rbind(
    results,
    data.frame(
      Gene1 = g1,
      Gene2 = g2,
      OR = res$odds_ratio,
      p_value = res$p_value,
      relationship_raw = res$relationship
    )
  )
}
results
```

## 3.4.3 Multiple Testing Correction
# Adjust p-values for multiple comparisons
```{r inv6_correction}
# Apply Bonferroni correction
results$p_adjust_bonf <- p.adjust(results$p_value, method = "bonferroni")

# decided to use Benjamini-Hochberg - explained in paper 
# OR apply Benjamini-Hochberg FDR correction
results$p_adjust_fdr <- p.adjust(results$p_value, method = "BH")

# Filter for significant pairs (adjusted p-value < 0.05)
results_signif <- subset(results, p_adjust_bonf < 0.05)
results
```

## 3.4.4 Identify Co-Mutation and Mutual Exclusivity
# Classify significant gene pairs
```{r inv6_classify}
# Co-mutation: Odds ratio > 1 and significant p-value
# [INSERT CODE HERE]

# Mutual exclusivity: Odds ratio < 1 and significant p-value
# [INSERT CODE HERE]

# Sort and display top co-mutating pairs
# [INSERT CODE HERE]

# Sort and display top mutually exclusive pairs
# [INSERT CODE HERE]


#since none are significant, should I examine pairs with the lowest uncorrected p-values or most extreme odds ratios? 
```

## 3.4.5 Visualize Gene-Gene Relationships
# Create heatmap and network diagram
```{r inv6_visualize}
# Create heatmap of odds ratios for top 20 genes
# [INSERT CODE HERE]

# Create network diagram showing significant relationships
# Nodes = genes, Edges = significant co-mutation/exclusivity
# Color edges by relationship type
# [INSERT CODE HERE]

# Create co-occurrence matrix
# [INSERT CODE HERE]
```

**Observations:**
# [COMMENT HERE: Which gene pairs co-mutate? Any mutual exclusivity patterns?]


# ==============================================================================
# INVESTIGATION 5: Disease-Specific Survival and Top 20 Genes
# ==============================================================================

## 3.5.1 Survival Analysis for Each Top Gene
# Test association between each gene mutation and DSS
```{r inv7_individual}
# For each of the top 20 genes:
# 1. Divide patients into mutated vs non-mutated groups
# 2. Create Kaplan-Meier curves for DSS
# 3. Perform log-rank test
# 4. Calculate hazard ratio using Cox proportional hazards model
# [INSERT CODE HERE]

# Store results in dataframe: gene, hazard_ratio, CI_lower, CI_upper, p_value
# [INSERT CODE HERE]
```

## 3.5.2 Multiple Testing Correction
# Adjust p-values for 20 comparisons
```{r inv7_correction}
# Apply Bonferroni or FDR correction
# [INSERT CODE HERE]

# Identify genes significantly associated with DSS
# [INSERT CODE HERE]
```

## 3.5.3 Visualize Results
# Create forest plot and summary table
```{r inv7_visualize}
# Create forest plot of hazard ratios with confidence intervals
# [INSERT CODE HERE]

# Create summary table with all results
# Columns: Gene, Mutation Frequency, HR, CI, p-value, adjusted p-value
# [INSERT CODE HERE]

# Visualize top genes with significant DSS association
# [INSERT CODE HERE]
```

**Observations:**
# [COMMENT HERE: Which genes are most strongly associated with DSS? Protective or harmful?]

# ==============================================================================
# SECTION 4: COMPREHENSIVE RESULTS SUMMARY
# ==============================================================================

## 4.1 Summary of Key Findings
```{r summary}
# Create comprehensive summary tables and figures

# --- DEMOGRAPHICS AND CLINICAL CHARACTERISTICS ---
# [INSERT CODE HERE]

# --- SURVIVAL OUTCOMES ---
# Median survival times for OS, DSS, PFS, DFS
# [INSERT CODE HERE]

# --- MUTATION ANALYSIS ---
# Top mutated genes and their frequencies
# [INSERT CODE HERE]

# --- CLUSTERING RESULTS ---
# Number of clusters, sizes, clinical associations
# [INSERT CODE HERE]

# --- GENE-GENE INTERACTIONS ---
# Significant co-mutations and mutual exclusivity
# [INSERT CODE HERE]

# --- PROGNOSTIC GENES ---
# Genes significantly associated with DSS
# [INSERT CODE HERE]
```


# ==============================================================================
# SECTION 5: DISCUSSION AND CONCLUSIONS
# ==============================================================================

## 5.1 Key Findings Summary

**Demographics:**
# [WRITE HERE: Summary of patient characteristics]

**Survival Patterns:**
# [WRITE HERE: Key survival trends, median times, prognostic factors]

**Mutation Landscape:**
# [WRITE HERE: Most frequently mutated genes, their biological significance]

**Patient Subgroups:**
# [WRITE HERE: Clusters identified, clinical differences, prognostic value]

**Gene Interactions:**
# [WRITE HERE: Co-mutations and mutual exclusivity patterns]

**Prognostic Biomarkers:**
# [WRITE HERE: Genes associated with survival, potential therapeutic targets]


## 5.2 Biological Interpretation

# [WRITE HERE: Discuss biological meaning of findings]
# - Are the top mutated genes known cancer drivers?
# - Do clusters represent known molecular subtypes?
# - What do co-mutation patterns suggest about tumor evolution?
# - Clinical implications for treatment stratification


## 5.3 Limitations

# [WRITE HERE: Study limitations]
# - Sample size considerations
# - Missing data
# - Potential confounders not adjusted for
# - Limitations of clustering methods used


## 5.4 Future Directions

# [WRITE HERE: Suggested next steps]
# - Validation in independent cohorts
# - Functional studies of candidate genes
# - Integration with other -omics data
# - Clinical trial design based on subgroups


# ==============================================================================
# END OF ANALYSIS
# ==============================================================================

